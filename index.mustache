<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>{{title}}</title>
  <script src="/fabric/fabric.js" type="text/javascript"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
<canvas id="board" width="500" height="500"></canvas>
<script type="text/javascript">
  var socket = io();
  socket.on('canvas', function(canvasContent){
    //canvas.loadFromJSON(canvasContent);
    canvas.add(JSON.stringify(canvasContent));
    console.log('OK');
  });
  var canvas = new fabric.Canvas('board');
  canvas.isDrawingMode = true;
  sendCanvas(canvas);

  function sendCanvas()
  {
    setTimeout(function(){
      if(canvas._objects.length > 0) {
        console.log(canvas._objects[canvas._objects.length - 1]);
        socket.emit('canvas', JSON.stringify(canvas._objects[canvas._objects.length - 1]));
      }
      sendCanvas();
    }, 500);
  }
</script>
</body>
</html>

